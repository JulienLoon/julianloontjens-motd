#!/bin/bash
# /etc/update-motd.d/01-system-info
# Distribution, uptime, load, kernel, date

RED="\033[31m"
WHITE="\033[37m"
RESET="\033[0m"

# --- Fetch system info ---
[ -r /etc/lsb-release ] && . /etc/lsb-release
if [ -z "$DISTRIB_DESCRIPTION" ] && command -v lsb_release >/dev/null 2>&1; then
    DISTRIB_DESCRIPTION=$(lsb_release -s -d)
fi

HOSTNAME=$(hostname)
UPTIME=$(uptime -p | sed 's/up //')
LOAD=$(awk '{print $1", "$2", "$3}' /proc/loadavg)
KERNEL=$(uname -r)
DATE=$(date +"%A %d %B %Y, %H:%M")
LOCAL_IP=$(hostname -I | awk '{print $1}')
EXTERNAL_IP=$(curl -s https://ifconfig.me || echo "N/A")

TEMP="N/A"
if command -v sensors >/dev/null 2>&1; then
    TEMP_LINE=$(sensors | grep -m1 -E '°C')
    [ -n "$TEMP_LINE" ] && TEMP=$(echo "$TEMP_LINE" | grep -oE '[0-9]+\.[0-9]+°C')
fi

# --- Prepare label/value array ---
declare -A SYSINFO
SYSINFO["Distribution"]="$DISTRIB_DESCRIPTION"
SYSINFO["Hostname"]="$HOSTNAME"
SYSINFO["Uptime"]="$UPTIME"
SYSINFO["Load"]="$LOAD"
SYSINFO["Kernel"]="$KERNEL"
SYSINFO["Date"]="$DATE"
SYSINFO["Local IP"]="$LOCAL_IP"
SYSINFO["External IP"]="$EXTERNAL_IP"
SYSINFO["Temperature"]="$TEMP"

# --- Compute longest label ---
MAXLEN=0
for label in "${!SYSINFO[@]}"; do
    [ ${#label} -gt $MAXLEN ] && MAXLEN=${#label}
done

# --- Print aligned ---
for label in "${!SYSINFO[@]}"; do
    printf "  ${RED}%-${MAXLEN}s${WHITE} %s${RESET}\n" "$label:" "${SYSINFO[$label]}"
done
